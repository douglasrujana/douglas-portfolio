---
/**
 * About/CV Page
 * 
 * Página ATS-friendly con CV completo
 * Incluye JSON-LD para SEO
 * Data mock fácil de actualizar
 */

import ExperienceTimeline from '@presentation/components/cv/ExperienceTimeline.svelte';
import SkillsGrid from '@presentation/components/cv/SkillsGrid.svelte';
import ChatIsland from '@presentation/islands/ChatIsland.astro';
import Navigation from '@presentation/components/ui/Navigation.svelte';
import ScrollToTop from '@presentation/components/ui/ScrollToTop.simple.svelte';
import Footer from '@presentation/components/ui/Footer.svelte';
import CertificationsTabs from '../presentation/components/cv/CertificationsTabs.svelte';
import {
  personalInfo,
  experiences,
  education,
  certifications,
  skills,
  languages,
  testimonials,
  getTotalYearsOfExperience,
  generatePersonSchema,
} from '../data/cv';
import { env } from '@infrastructure/config/env';

// Set current path for active navigation highlighting
const currentPath = '/about';

// Función para obtener el color según el nivel de habilidad
const getLevelColor = (level: number): string => {
  if (level >= 4) return '#10b981'; // Verde para avanzado
  if (level >= 3) return '#3b82f6'; // Azul para intermedio
  return '#6b7280'; // Gris para básico
};

const yearsOfExperience = getTotalYearsOfExperience();
const personSchema = generatePersonSchema();

// Social URLs
const telegramUrl = env.TELEGRAM_BOT_USERNAME ? `https://t.me/${env.TELEGRAM_BOT_USERNAME}` : undefined;
const whatsappUrl = env.WHATSAPP_NUMBER ? `https://wa.me/${env.WHATSAPP_NUMBER}?text=Hola%20Douglas,%20vi%20tu%20CV` : undefined;

// Meta
const title = `${personalInfo.name} - CV & About`;
const description = `${personalInfo.title} con ${yearsOfExperience}+ años de experiencia. ${personalInfo.summary}`;
---

<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>{title}</title>
    <meta name="description" content={description} />
    
    <!-- Open Graph -->
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:type" content="profile" />
    <meta property="og:image" content={personalInfo.avatar} />
    
    <!-- Structured Data (ATS & SEO) -->
    <script type="application/ld+json" set:html={JSON.stringify(personSchema)} />
    
    <link rel="icon" type="image/svg+xml" href="/favicon.svg" />
  </head>
  
  <body>
    <!-- Navegación Principal -->
    <header role="banner">
      <Navigation client:load currentPath={currentPath} />
    </header>
    
    <main>
      <!-- Sección Hero -->
      <section class="about-hero" aria-labelledby="hero-heading">
        <div class="container-jony">
          <div class="hero-content">
            <div class="hero-text">
              <h1 id="hero-heading" class="hero-title">{personalInfo.name}</h1>
              <p class="hero-subtitle">{personalInfo.title}</p>
              <p class="hero-summary">{personalInfo.summary}</p>
              
              <div class="hero-stats" role="list" aria-label="Estadísticas profesionales">
                <div class="stat-item" role="listitem">
                  <strong>{yearsOfExperience}+</strong>
                  <span>Años de experiencia</span>
                </div>
                <div class="stat-item" role="listitem">
                  <strong>{experiences.length}</strong>
                  <span>Posiciones</span>
                </div>
                <div class="stat-item" role="listitem">
                  <strong>{certifications.length}</strong>
                  <span>Certificaciones</span>
                </div>
              </div>

            <div class="hero-actions">
              <a href="#experience" class="btn-jony btn-primary">
                Ver experiencia
              </a>
              <a href="#download-cv" class="btn-jony btn-secondary">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                  <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
                  <polyline points="7 10 12 15 17 10"></polyline>
                  <line x1="12" y1="15" x2="12" y2="3"></line>
                </svg>
                Descargar CV
              </a>
            </div>
          </div>

          <div class="hero-image">
            <img 
              src={personalInfo.avatar} 
              alt={`Fotografía de ${personalInfo.name}`} 
              width="200" 
              height="200"
              loading="lazy"
              decoding="async"
            />
            <div class="hero-contact" role="complementary" aria-label="Redes sociales">
              <a 
                href={personalInfo.linkedin} 
                target="_blank" 
                rel="noopener noreferrer" 
                class="contact-link"
                aria-label="Perfil de LinkedIn"
              >
                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor" aria-hidden="true">
                  <path d="M16 8a6 6 0 016 6v7h-4v-7a2 2 0 00-2-2 2 2 0 00-2 2v7h-4v-7a6 6 0 016-6zM2 9h4v12H2z"></path>
                  <circle cx="4" cy="4" r="2"></circle>
                </svg>
                LinkedIn
              </a>
              <a href={personalInfo.github} target="_blank" rel="noopener" class="contact-link">
                <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                  <path d="M9 19c-5 1.5-5-2.5-7-3m14 6v-3.87a3.37 3.37 0 00-.94-2.61c3.14-.35 6.44-1.54 6.44-7A5.44 5.44 0 0020 4.77 5.07 5.07 0 0019.91 1S18.73.65 16 2.48a13.38 13.38 0 00-7 0C6.27.65 5.09 1 5.09 1A5.07 5.07 0 005 4.77a5.44 5.44 0 00-1.5 3.78c0 5.42 3.3 6.61 6.44 7A3.37 3.37 0 009 18.13V22"></path>
                </svg>
                GitHub
              </a>
              {telegramUrl && (
                <a href={telegramUrl} target="_blank" rel="noopener" class="contact-link">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M11.944 0A12 12 0 0 0 0 12a12 12 0 0 0 12 12 12 12 0 0 0 12-12A12 12 0 0 0 12 0a12 12 0 0 0-.056 0zm4.962 7.224c.1-.002.321.023.465.14a.506.506 0 0 1 .171.325c.016.093.036.306.02.472-.18 1.898-.962 6.502-1.36 8.627-.168.9-.499 1.201-.82 1.23-.696.065-1.225-.46-1.9-.902-1.056-.693-1.653-1.124-2.678-1.8-1.185-.78-.417-1.21.258-1.91.177-.184 3.247-2.977 3.307-3.23.007-.032.014-.15-.056-.212s-.174-.041-.249-.024c-.106.024-1.793 1.14-5.061 3.345-.48.33-.913.49-1.302.48-.428-.008-1.252-.241-1.865-.44-.752-.245-1.349-.374-1.297-.789.027-.216.325-.437.893-.663 3.498-1.524 5.83-2.529 6.998-3.014 3.332-1.386 4.025-1.627 4.476-1.635z"/>
                  </svg>
                  Telegram
                </a>
              )}
              {whatsappUrl && (
                <a href={whatsappUrl} target="_blank" rel="noopener" class="contact-link">
                  <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
                    <path d="M17.472 14.382c-.297-.149-1.758-.867-2.03-.967-.273-.099-.471-.148-.67.15-.197.297-.767.966-.94 1.164-.173.199-.347.223-.644.075-.297-.15-1.255-.463-2.39-1.475-.883-.788-1.48-1.761-1.653-2.059-.173-.297-.018-.458.13-.606.134-.133.298-.347.446-.52.149-.174.198-.298.298-.497.099-.198.05-.371-.025-.52-.075-.149-.669-1.612-.916-2.207-.242-.579-.487-.5-.669-.51-.173-.008-.371-.01-.57-.01-.198 0-.52.074-.792.372-.272.297-1.04 1.016-1.04 2.479 0 1.462 1.065 2.875 1.213 3.074.149.198 2.096 3.2 5.077 4.487.709.306 1.262.489 1.694.625.712.227 1.36.195 1.871.118.571-.085 1.758-.719 2.006-1.413.248-.694.248-1.289.173-1.413-.074-.124-.272-.198-.57-.347m-5.421 7.403h-.004a9.87 9.87 0 01-5.031-1.378l-.361-.214-3.741.982.998-3.648-.235-.374a9.86 9.86 0 01-1.51-5.26c.001-5.45 4.436-9.884 9.888-9.884 2.64 0 5.122 1.03 6.988 2.898a9.825 9.825 0 012.893 6.994c-.003 5.45-4.437 9.884-9.885 9.884m8.413-18.297A11.815 11.815 0 0012.05 0C5.495 0 .16 5.335.157 11.892c0 2.096.547 4.142 1.588 5.945L.057 24l6.305-1.654a11.882 11.882 0 005.683 1.448h.005c6.554 0 11.89-5.335 11.893-11.893a11.821 11.821 0 00-3.48-8.413Z"/>
                  </svg>
                  WhatsApp
                </a>
              )}
            </div>
          </div>
        </div>
      </div>
    </section>

    <!-- Experiencia Laboral -->
    <section id="experience" class="section-jony" aria-labelledby="experience-heading">
      <div class="container-jony">
        <h2 id="experience-heading" class="section-title">Experiencia Laboral</h2>
        <ExperienceTimeline client:visible experiences={experiences} />
      </div>
    </section>

    <!-- Habilidades Técnicas -->
    <section id="skills" class="section-jony" style="background: var(--color-gray-50);" aria-labelledby="skills-heading">
      <div class="container-jony">
        <div class="section-header">
          <h2 id="skills-heading" class="section-title">Habilidades Técnicas</h2>
          <p class="section-description">
            Tecnologías y herramientas que domino, con mi nivel de competencia y años de experiencia en cada una.
          </p>
        </div>
        
        <div class="skills-container">
          {skills.map((category, catIndex) => (
            <div class="skill-category" data-aos="fade-up" data-aos-delay={catIndex * 50}>
              <div class="category-header">
                <h3 class="category-title">{category.category}</h3>
                <span class="category-count">{category.skills.length} habilidades</span>
              </div>
              
              <div class="skills-list">
                {category.skills.map((skill, skillIndex) => {
                  // Calcular el porcentaje basado en el nivel (1-5)
                  const percentage = (skill.level / 5) * 100;
                  const years = skill.yearsOfExperience || 0;
                  
                  return (
                    <div class="skill-item">
                      <div class="skill-info">
                        <span class="skill-name">{skill.name}</span>
                        <span class="skill-level">
                          {skill.level >= 4 ? 'Avanzado' : 
                           skill.level >= 3 ? 'Intermedio' : 'Básico'}
                          {years > 0 && ` • ${years}+ año${years !== 1 ? 's' : ''}`}
                        </span>
                      </div>
                      <div class="skill-bar">
                        <div 
                          class="skill-progress" 
                          style={{
                            width: `${percentage}%`,
                            background: getLevelColor(skill.level)
                          }}
                          aria-valuenow={skill.level}
                          aria-valuemin="1"
                          aria-valuemax="5"
                        ></div>
                      </div>
                    </div>
                  );
                })}
              </div>
            </div>
          ))}
        </div>
      </div>
    </section>

    <!-- Education & Certifications -->
    <section id="education" class="section-jony">
      <div class="container-jony">
        <div class="edu-cert-grid">
          <!-- Education -->
          <div class="edu-section">
            <h2 class="section-title">Educación</h2>
            {education.map((edu) => (
              <div class="edu-card">
                <h3 class="edu-degree">{edu.degree}</h3>
                <p class="edu-field">{edu.field}</p>
                <p class="edu-institution">{edu.institution}</p>
                <p class="edu-location">{edu.location}</p>
                <p class="edu-dates">{edu.startDate} - {edu.endDate}</p>
                {edu.gpa && <p class="edu-gpa">GPA: {edu.gpa}</p>}
                {edu.honors && (
                  <div class="edu-honors">
                    {edu.honors.map((honor) => (
                      <span class="honor-badge">{honor}</span>
                    ))}
                  </div>
                )}
              </div>
            ))}
          </div>

          <!-- Certificaciones -->
          <div class="cert-section">
            <h2 class="section-title">Certificaciones</h2>
            <CertificationsTabs client:load />
          </div>
        </div>
      </div>
    </section>

    <!-- Testimonials -->
    <section id="testimonials" class="section-jony" style="background: var(--color-gray-50);">
      <div class="container-jony">
        <h2 class="section-title">Testimonios</h2>
        <div class="testimonials-grid">
          {testimonials.map((test) => (
            <div class="testimonial-card">
              <p class="testimonial-text">"{test.text}"</p>
              <div class="testimonial-author">
                {test.avatar && (
                  <img src={test.avatar} alt={test.name} class="author-avatar" />
                )}
                <div class="author-info">
                  <strong class="author-name">{test.name}</strong>
                  <p class="author-position">{test.position} en {test.company}</p>
                  {test.linkedin && (
                    <a href={test.linkedin} target="_blank" rel="noopener" class="author-linkedin">
                      Ver perfil →
                    </a>
                  )}
                </div>
              </div>
            </div>
          ))}
        </div>
      </div>
    </section>

    <!-- Languages -->
    <section class="section-jony">
      <div class="container-jony">
        <h2 class="section-title">Idiomas</h2>
        <div class="languages-list">
          {languages.map((lang) => (
            <div class="language-item">
              <span class="language-name">{lang.name}</span>
              <span class="language-level">{lang.proficiency}</span>
            </div>
          ))}
        </div>
      </div>
    </section>

    <!-- Sección de Contacto -->
    <section id="download-cv" class="section-jony" style="background: var(--color-gray-50); text-align: center;" aria-labelledby="contact-heading">
      <div class="container-jony">
        <h2 id="contact-heading" class="section-title">¿Interesado en trabajar conmigo?</h2>
        <p style="max-width: 600px; margin: 0 auto var(--space-xl); color: var(--color-gray-600);">
          Descarga mi CV en formato PDF o contáctame directamente. Estoy disponible para
          proyectos freelance y posiciones full-time remotas.
        </p>
        <div style="display: flex; justify-content: center; gap: var(--space-md); flex-wrap: wrap;">
          <button class="btn-jony btn-primary">
            <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
              <path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"></path>
              <polyline points="7 10 12 15 17 10"></polyline>
              <line x1="12" y1="15" x2="12" y2="3"></line>
            </svg>
            Descargar CV (PDF)
          </button>
          <a href={`mailto:${personalInfo.email}`} class="btn-jony btn-secondary">
            Enviar Email
          </a>
        </div>
      </div>
    </section>

    </section>
    
    <!-- Pie de página -->
    <Footer 
      currentYear={2025}
      showTechCredits={true}
      socialLinks={{
        github: personalInfo.github,
        linkedin: personalInfo.linkedin,
        telegram: telegramUrl,
        whatsapp: whatsappUrl,
        email: personalInfo.email
      }}
    />

    </main>
    
    <!-- Chat de asistencia -->
    <ChatIsland aria-label="Chat de asistencia" />
    
    <!-- Botón de Scroll to Top -->
    <ScrollToTop client:load />
  </body>
</html>

<style is:global>
  @import '../styles/jony-ive.css';
</style>

<style>
  /* Section Header */
  .section-header {
    text-align: center;
    margin-bottom: var(--space-xl);
  }

  .section-title {
    font-size: clamp(2rem, 5vw, 2.5rem);
    font-weight: 300;
    margin-bottom: var(--space-md);
    color: var(--color-gray-900);
  }

  .section-description {
    font-size: 1.125rem;
    color: var(--color-gray-600);
    line-height: 1.7;
    max-width: 700px;
    margin: 0 auto;
  }

  /* Skills Section */
  .skills-container {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
    gap: var(--space-xl);
    margin-top: var(--space-xl);
  }

  .skill-category {
    background: var(--color-white);
    border-radius: var(--radius-lg);
    padding: var(--space-lg);
    border: 1px solid var(--color-gray-200);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.05);
    transition: all 0.3s ease;
  }

  .skill-category:hover {
    transform: translateY(-4px);
    box-shadow: 0 10px 25px rgba(0, 0, 0, 0.1);
  }

  .category-header {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: var(--space-md);
    padding-bottom: var(--space-sm);
    border-bottom: 2px solid var(--color-gray-100);
  }

  .category-title {
    font-size: 1.25rem;
    font-weight: 600;
    color: var(--color-gray-900);
    margin: 0;
  }

  .category-count {
    font-size: 0.85rem;
    background: var(--color-gray-100);
    color: var(--color-gray-600);
    padding: 0.2rem 0.6rem;
    border-radius: 20px;
    font-weight: 500;
  }

  .skills-list {
    display: flex;
    flex-direction: column;
    gap: var(--space-md);
  }

  .skill-item {
    width: 100%;
  }

  .skill-info {
    display: flex;
    justify-content: space-between;
    margin-bottom: 0.3rem;
  }

  .skill-name {
    font-weight: 500;
    color: var(--color-gray-800);
    font-size: 0.95rem;
  }

  .skill-level {
    font-size: 0.8rem;
    color: var(--color-gray-500);
    font-weight: 500;
  }

  .skill-bar {
    width: 100%;
    height: 8px;
    background: var(--color-gray-100);
    border-radius: 10px;
    overflow: hidden;
  }

  .skill-progress {
    height: 100%;
    border-radius: 10px;
    transition: width 1s ease-in-out;
  }

  /* Responsive */
  @media (max-width: 768px) {
    .skills-container {
      grid-template-columns: 1fr;
    }
    
    .skill-category {
      padding: var(--space-md);
    }
  }

  /* Header */
  .page-header {
    padding: var(--space-lg) 0;
    border-bottom: 1px solid var(--color-gray-200);
    position: sticky;
    top: 0;
    background: rgba(255, 255, 255, 0.9);
    backdrop-filter: blur(10px);
    z-index: 100;
  }

  .page-nav {
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .nav-link {
    display: flex;
    align-items: center;
    gap: var(--space-xs);
    font-size: 0.9375rem;
    color: var(--color-gray-700);
    transition: color var(--transition-base);
  }

  .nav-link:hover {
    color: var(--color-gray-900);
  }

  .nav-actions {
    display: flex;
    align-items: center;
    gap: var(--space-lg);
  }

  /* Hero */
  .about-hero {
    padding: var(--space-2xl) 0;
  }

  .hero-content {
    display: grid;
    grid-template-columns: 1.5fr 1fr;
    gap: var(--space-2xl);
    align-items: center;
  }

  .hero-title {
    font-size: clamp(2.5rem, 5vw, 4rem);
    font-weight: 300;
    margin-bottom: var(--space-sm);
  }

  .hero-subtitle {
    font-size: clamp(1.25rem, 3vw, 1.75rem);
    color: var(--color-gray-600);
    font-weight: 300;
    margin-bottom: var(--space-lg);
  }

  .hero-summary {
    font-size: 1.0625rem;
    line-height: 1.7;
    color: var(--color-gray-700);
    margin-bottom: var(--space-xl);
  }

  .hero-stats {
    display: flex;
    gap: var(--space-xl);
    margin-bottom: var(--space-xl);
  }

  .stat-item {
    display: flex;
    flex-direction: column;
    gap: var(--space-xs);
  }

  .stat-item strong {
    font-size: 2rem;
    font-weight: 300;
    color: var(--color-gray-900);
  }

  .stat-item span {
    font-size: 0.875rem;
    color: var(--color-gray-600);
  }

  .hero-actions {
    display: flex;
    gap: var(--space-md);
    flex-wrap: wrap;
  }

  .hero-image {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: var(--space-lg);
  }

  .hero-image img {
    width: 200px;
    height: 200px;
    border-radius: 50%;
    border: 4px solid var(--color-gray-200);
  }

  .hero-contact {
    display: flex;
    gap: var(--space-md);
  }

  .contact-link {
    display: flex;
    align-items: center;
    gap: var(--space-xs);
    padding: var(--space-sm) var(--space-md);
    background: var(--color-gray-100);
    border-radius: var(--radius-md);
    font-size: 0.875rem;
    color: var(--color-gray-700);
    transition: all var(--transition-base);
  }

  .contact-link:hover {
    background: var(--color-gray-900);
    color: var(--color-white);
  }

  /* Section Title */
  .section-title {
    font-size: 2.5rem;
    font-weight: 300;
    text-align: center;
    margin-bottom: var(--space-xl);
  }

  /* Education & Certifications */
  .edu-cert-grid {
    display: grid;
    grid-template-columns: 1fr;
    gap: 3rem;
    gap: var(--space-2xl);
  }

  .edu-card {
    background: var(--color-white);
    padding: var(--space-lg);
    border-radius: var(--radius-lg);
    border: 1px solid var(--color-gray-200);
  }

  .edu-degree {
    font-size: 1.25rem;
    font-weight: 500;
    margin-bottom: var(--space-xs);
  }

  .edu-field, .edu-institution {
    color: var(--color-gray-700);
    margin-bottom: var(--space-xs);
  }

  .edu-dates, .edu-location {
    font-size: 0.875rem;
    color: var(--color-gray-500);
    margin-bottom: var(--space-xs);
  }

  .edu-honors {
    display: flex;
    gap: var(--space-xs);
    flex-wrap: wrap;
    margin-top: var(--space-md);
  }

  .honor-badge {
    padding: var(--space-xs) var(--space-sm);
    background: var(--color-accent-light);
    color: var(--color-accent);
    border-radius: var(--radius-sm);
    font-size: 0.75rem;
    font-weight: 500;
  }

  .cert-section {
    width: 100%;
  }

  /* Testimonials */
  .testimonials-grid {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(320px, 1fr));
    gap: var(--space-lg);
  }

  .testimonial-card {
    background: var(--color-white);
    padding: var(--space-lg);
    border-radius: var(--radius-lg);
    border: 1px solid var(--color-gray-200);
  }

  .testimonial-text {
    font-size: 1rem;
    line-height: 1.7;
    color: var(--color-gray-700);
    margin-bottom: var(--space-lg);
    font-style: italic;
  }

  .testimonial-author {
    display: flex;
    gap: var(--space-md);
    align-items: center;
  }

  .author-avatar {
    width: 48px;
    height: 48px;
    border-radius: 50%;
  }

  .author-name {
    display: block;
    color: var(--color-gray-900);
    margin-bottom: var(--space-xs);
  }

  .author-position {
    font-size: 0.875rem;
    color: var(--color-gray-600);
    margin-bottom: var(--space-xs);
  }

  .author-linkedin {
    font-size: 0.875rem;
    color: var(--color-accent);
  }

  /* Languages */
  .languages-list {
    display: flex;
    justify-content: center;
    gap: var(--space-xl);
    flex-wrap: wrap;
  }

  .language-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: var(--space-xs);
  }

  .language-name {
    font-size: 1.125rem;
    font-weight: 500;
  }

  .language-level {
    font-size: 0.875rem;
    color: var(--color-gray-600);
    text-transform: capitalize;
  }

  /* Footer */
  .footer {
    padding: var(--space-xl) 0;
    border-top: 1px solid var(--color-gray-200);
  }

  /* Responsive */
  @media (max-width: 1024px) {
    .hero-content {
      grid-template-columns: 1fr;
    }

    .hero-image {
      order: -1;
    }

    .edu-cert-grid {
      grid-template-columns: 1fr;
    }
  }

  @media (max-width: 768px) {
    .hero-stats {
      gap: var(--space-lg);
    }

    .nav-actions {
      gap: var(--space-md);
    }

    .testimonials-grid {
      grid-template-columns: 1fr;
    }
  }
</style>
